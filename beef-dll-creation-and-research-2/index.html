<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Beef DLL Creation &amp; Research - Based And Pasted</title><meta name="description" content=" Beef language is still in heavy development. Anything can change at any time in Beef language and thus this document may not be valid anymore! Beef is an open source performance-oriented compiled programming language. Basically it's C language with C# like syntax. OOP paradigm&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://m0n7y5.github.io/beef-dll-creation-and-research-2/"><link rel="alternate" type="application/atom+xml" href="https://m0n7y5.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://m0n7y5.github.io/feed.json"><meta property="og:title" content="Beef DLL Creation & Research"><meta property="og:image" content="https://m0n7y5.github.io/media/posts/4/screenEdited.png"><meta property="og:site_name" content="Based And Pasted"><meta property="og:description" content=" Beef language is still in heavy development. Anything can change at any time in Beef language and thus this document may not be valid anymore! Beef is an open source performance-oriented compiled programming language. Basically it's C language with C# like syntax. OOP paradigm&hellip;"><meta property="og:url" content="https://m0n7y5.github.io/beef-dll-creation-and-research-2/"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://m0n7y5.github.io/media/website/Logo-V2-5-2K.png" type="image/png"><style>:root{--body-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--heading-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--logo-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--menu-font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"}</style><link rel="stylesheet" href="https://m0n7y5.github.io/assets/css/style.css?v=b2809a75655d751b3d4b8f18ae0dcea9"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://m0n7y5.github.io/beef-dll-creation-and-research-2/"},"headline":"Beef DLL Creation & Research","datePublished":"2020-09-01T15:52","dateModified":"2020-09-03T13:53","image":{"@type":"ImageObject","url":"https://m0n7y5.github.io/media/posts/4/screenEdited.png","height":1160,"width":1920},"description":" Beef language is still in heavy development. Anything can change at any time in Beef language and thus this document may not be valid anymore! Beef is an open source performance-oriented compiled programming language. Basically it's C language with C# like syntax. OOP paradigm&hellip;","author":{"@type":"Person","name":"Admin"},"publisher":{"@type":"Organization","name":"Admin"}}</script><script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.2/build/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/atom-one-dark-reasonable.min.css"><link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300&display=swap" rel="stylesheet"></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://m0n7y5.github.io/">Based And Pasted</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://m0n7y5.github.io/" target="_self">Home</a></li><li><a href="https://m0n7y5.github.io/about-me/" target="_self">About me</a></li></ul></nav></header><main><article class="post"><div class="hero"><figure class="hero__image hero__image--overlay"><img src="https://m0n7y5.github.io/media/posts/4/screenEdited.png" srcset="https://m0n7y5.github.io/media/posts/4/responsive/screenEdited-xs.png 300w, https://m0n7y5.github.io/media/posts/4/responsive/screenEdited-sm.png 480w, https://m0n7y5.github.io/media/posts/4/responsive/screenEdited-md.png 768w, https://m0n7y5.github.io/media/posts/4/responsive/screenEdited-lg.png 1024w, https://m0n7y5.github.io/media/posts/4/responsive/screenEdited-xl.png 1360w, https://m0n7y5.github.io/media/posts/4/responsive/screenEdited-2xl.png 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="1160" width="1920" alt=""><figcaption>Showcase of fully functional Beef DLL</figcaption></figure><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2020-09-01T15:52">September 1, 2020</time></div><h1>Beef DLL Creation &amp; Research</h1><div class="post__meta post__meta--author"><img src="https://m0n7y5.github.io/media/website/kek2_H200.png" loading="eager" alt="Admin" class="post__author-thumb"> <a href="https://m0n7y5.github.io/authors/admin/" class="feed__author invert">Admin</a></div></div></header></div><div class="wrapper post__entry"><p class="msg msg--warning">Beef language is still in heavy development. Anything can change at any time in Beef language and thus this document may not be valid anymore!</p><p></p><div class="post__toc"><h3>Content</h3><ul><li><a href="#requirementsnbspbr">Requirements&nbsp;<br></a></li><li><a href="#about-beefbr">About Beef<br></a></li><li><a href="#beef-dll-and-dllmain">Beef DLL and DllMain</a></li><li><a href="#exporting-methods">Exporting methods</a></li><li><a href="#how-to-work-with-threads">How to work with threads</a></li></ul></div><h2 id="requirementsnbspbr">Requirements&nbsp;<br></h2><ul><li>Latest BeefIDE (nightly)</li><li>DebugView++</li></ul><h2 id="about-beefbr">About Beef<br></h2><p>Beef is an open source performance-oriented compiled programming language. Basically it's C language with C# like syntax. OOP paradigm also can be used for developing applications since in Beef you can create custom reference types (Objects) and combine it with polymorphism. Reflection is also possible. Its quite fast and its fun to work with. More info can be found here -&gt; https://www.beeflang.org/</p><h2 id="beef-dll-and-dllmain">Beef DLL and DllMain</h2><p>So first we need to create DLL project in Beef IDE. Go to File -&gt; New -&gt; New Project and choose Dynamic Library.</p><figure class="post__image post__image--center"><img loading="lazy" src="https://m0n7y5.github.io/media/posts/4/ProjectCreation.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://m0n7y5.github.io/media/posts/4/responsive/ProjectCreation-xs.png 300w, https://m0n7y5.github.io/media/posts/4/responsive/ProjectCreation-sm.png 480w, https://m0n7y5.github.io/media/posts/4/responsive/ProjectCreation-md.png 768w, https://m0n7y5.github.io/media/posts/4/responsive/ProjectCreation-lg.png 1024w, https://m0n7y5.github.io/media/posts/4/responsive/ProjectCreation-xl.png 1360w, https://m0n7y5.github.io/media/posts/4/responsive/ProjectCreation-2xl.png 1600w" height="282" width="372" alt=""></figure><p>Now we need to add new class called Program. Like this:</p><pre class="line-numbers language-csharp"><code>namespace DLLResearch
{
	public static class Program
	{
	}
}</code></pre><p>So... Normally when you are creating DLL (for example in C/++) you define DllMain method which is gonna be called when a process is going to try and load our library using, for example, LoadLibrary function from Win32 API. However, this is not possible in Beef since DllMain is already handled by Beef Runtime.<br><br>So what we gonna do now? ðŸ¤” It turns out that the solution is very simple. Only thing we need to do is write a public static constructor and deconstructor for class Program.</p><pre class="line-numbers language-csharp"><code>using System.Diagnostics;
using System;
namespace DLLResearch
{
        [AlwaysInclude] // &lt;- We need this to include our class in DLL, Normally you dont need this
	public static class Program
	{
		public static this() // &lt;- This will gets called when our library gets loaded
		{
			Debug.WriteLine("Hello From Beef DLL :3");
		}

		public static ~this() // &lt;- This will gets called when our library gets unloaded
		{
			Debug.WriteLine("See ya next time my friend :)");
		}
	}
}</code></pre><p>So lets compile it and inject it into some process. I am gonna use notepad.<br>As you can see, when we inject our library into notepad we can see this in DebugView++.<br></p><figure class="post__image post__image--center"><img loading="lazy" src="https://m0n7y5.github.io/media/posts/4/Loaded1.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://m0n7y5.github.io/media/posts/4/responsive/Loaded1-xs.png 300w, https://m0n7y5.github.io/media/posts/4/responsive/Loaded1-sm.png 480w, https://m0n7y5.github.io/media/posts/4/responsive/Loaded1-md.png 768w, https://m0n7y5.github.io/media/posts/4/responsive/Loaded1-lg.png 1024w, https://m0n7y5.github.io/media/posts/4/responsive/Loaded1-xl.png 1360w, https://m0n7y5.github.io/media/posts/4/responsive/Loaded1-2xl.png 1600w" height="130" width="701" alt=""><figcaption>DebugView++ Output: Printed message from static contructor</figcaption></figure><p>Our constructor get called and we printed first message. So lets try to unload our library and see what happens.&nbsp;<br></p><figure class="post__image post__image--center"><img loading="lazy" src="https://m0n7y5.github.io/media/posts/4/Unloaded1.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://m0n7y5.github.io/media/posts/4/responsive/Unloaded1-xs.png 300w, https://m0n7y5.github.io/media/posts/4/responsive/Unloaded1-sm.png 480w, https://m0n7y5.github.io/media/posts/4/responsive/Unloaded1-md.png 768w, https://m0n7y5.github.io/media/posts/4/responsive/Unloaded1-lg.png 1024w, https://m0n7y5.github.io/media/posts/4/responsive/Unloaded1-xl.png 1360w, https://m0n7y5.github.io/media/posts/4/responsive/Unloaded1-2xl.png 1600w" height="142" width="686" alt=""><figcaption>DebugView++ Output: Printed message from static decontructor</figcaption></figure><p>Looks like our deconstructor gets called.<br></p><p class="msg msg--highlight"><strong>Note:</strong> Our deconstructor also gets called when process, where our library is loaded, gonna exit.<br></p><h2 id="exporting-methods">Exporting methods</h2><p>So what if we want to export some methods from our DLL? Well... Thats a really simple task. Just write your method and throw <code>ExportAttribute</code> on it like this:</p><pre class="line-numbers language-csharp"><code>[Export]
public static int32 MyAmazingMethod(int32 a, int32 b)
{
    return a + b;
}</code></pre><p>This will export your method using Beef style mangling. Ez ...&nbsp;</p><figure class="post__image post__image--center"><img loading="lazy" src="https://m0n7y5.github.io/media/posts/4/peview_ZD5g1EkpwT.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://m0n7y5.github.io/media/posts/4/responsive/peview_ZD5g1EkpwT-xs.png 300w, https://m0n7y5.github.io/media/posts/4/responsive/peview_ZD5g1EkpwT-sm.png 480w, https://m0n7y5.github.io/media/posts/4/responsive/peview_ZD5g1EkpwT-md.png 768w, https://m0n7y5.github.io/media/posts/4/responsive/peview_ZD5g1EkpwT-lg.png 1024w, https://m0n7y5.github.io/media/posts/4/responsive/peview_ZD5g1EkpwT-xl.png 1360w, https://m0n7y5.github.io/media/posts/4/responsive/peview_ZD5g1EkpwT-2xl.png 1600w" height="75" width="516" alt=""><figcaption>Exported method using Beef-style mangling</figcaption></figure><p>But what if you want to use your exported method in some app using C-style API? Then you need to add <code>CLinkAttribute</code>. That will export your method using C-style mangling.</p><pre class="line-numbers language-csharp"><code>[Export, CLink]
public static int32 MyAmazingMethod(int32 a, int32 b)
{
    return a + b;
}</code></pre><figure class="post__image post__image--center"><img loading="lazy" src="https://m0n7y5.github.io/media/posts/4/peview_GBlChSEyrD.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://m0n7y5.github.io/media/posts/4/responsive/peview_GBlChSEyrD-xs.png 300w, https://m0n7y5.github.io/media/posts/4/responsive/peview_GBlChSEyrD-sm.png 480w, https://m0n7y5.github.io/media/posts/4/responsive/peview_GBlChSEyrD-md.png 768w, https://m0n7y5.github.io/media/posts/4/responsive/peview_GBlChSEyrD-lg.png 1024w, https://m0n7y5.github.io/media/posts/4/responsive/peview_GBlChSEyrD-xl.png 1360w, https://m0n7y5.github.io/media/posts/4/responsive/peview_GBlChSEyrD-2xl.png 1600w" height="70" width="337" alt=""><figcaption>Exported method using C-style mangling</figcaption></figure><p>See? It's that easy!&nbsp;</p><p>In case we need C++ mangling we can use&nbsp;<code>LinkNameAttribute</code>. You can use this attribute to specify link name for importing methods from another library or to specify mangling style for exported method. Actually you don't need <code>CLinkAttribute</code> at all. You can use <code>LinkName(.C)</code> instead!</p><pre class="line-numbers language-csharp"><code>[Export, LinkName(.CPP)]
public static int32 MyAmazingMethod(int32 a, int32 b)
{
    return a + b;
}</code></pre><figure class="post__image post__image--center"><img loading="lazy" src="https://m0n7y5.github.io/media/posts/4/peview_k4UffocXyl.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://m0n7y5.github.io/media/posts/4/responsive/peview_k4UffocXyl-xs.png 300w, https://m0n7y5.github.io/media/posts/4/responsive/peview_k4UffocXyl-sm.png 480w, https://m0n7y5.github.io/media/posts/4/responsive/peview_k4UffocXyl-md.png 768w, https://m0n7y5.github.io/media/posts/4/responsive/peview_k4UffocXyl-lg.png 1024w, https://m0n7y5.github.io/media/posts/4/responsive/peview_k4UffocXyl-xl.png 1360w, https://m0n7y5.github.io/media/posts/4/responsive/peview_k4UffocXyl-2xl.png 1600w" height="66" width="506" alt=""><figcaption>Exported method using C++ style mangling</figcaption></figure><p>As you can see, <strong>calling convention</strong> <code>__cdecl</code> is used by default. If you want to change that, you need to use&nbsp;<code>CallingConventionAttribute</code>. For example, this is how we export our method using <code>__stdcall</code> calling convention ...</p><pre class="line-numbers language-csharp"><code>[Export, LinkName(.CPP), CallingConvention(.Stdcall)]
public static int32 MyAmazingMethod(int32 a, int32 b)
{
    return a + b;
}</code></pre><p class="msg msg--highlight"><strong>Note:</strong> That works only when we are targeting x86 platform</p><h2 id="how-to-work-with-threads">How to work with threads</h2><p class="msg msg--warning"><strong>WARNING!</strong>&nbsp; Due to a bug in previous version of Beef, this works only in version 0.42.6 (Nightly 09/02/2020) and newer!</p><p>So ... what if we want to use threads? How can we start a thread on DLL loading and how can we terminate thread on DLL unloading? We also need to make sure that the process, where our DLL is loaded, will exit gracefully.</p><p>Lets add one thread called <code>myThread</code> and initialize it, so it will run our method called <code>ThreadMethod</code>.</p><pre class="line-numbers language-csharp"><code>using System.Diagnostics;
using System;
using System.Threading;
namespace DLLResearch
{
	[AlwaysInclude]
	public static class Program
	{
		public static Thread myThread = new Thread(new () =&gt; ThreadMethod());

		public static this()
		{
			Debug.WriteLine("Hello From Beef DLL :3");
		}

		public static ~this()
		{
			Debug.WriteLine("See ya next time my friend :)");
		}

		public static void ThreadMethod()
		{
			//...
		}
	}
}</code></pre><p>Right now, it will just initialize new thread and nothing else. Let's say that we want our thread periodically print some message. Our <code>ThreadMethod</code> will gonna look like this:</p><pre class="line-numbers language-csharp"><code>public static void ThreadMethod()
{
    Debug.WriteLine("ThreadMethod started.");
    var i = 0; 
    while(true)
    {
        Debug.WriteLine("Hello from Beef DLL. Counter: {}", i++);
        Thread.Sleep(500); // Wait 500 ms
    }
    Debug.WriteLine("ThreadMethod ended.");
}</code></pre><p>But this code has one big problem. In this case, our DLL will not be unloaded from a process, because <code>ThreadMethod</code> <strong>will never end!</strong> We need some form of signalization that will notify our thread that we want to exit. How we are gonna do that? Simply declare new static boolean called <code>exit</code>. And replace <code>while(true)</code> with&nbsp;<code>while(!exit)</code>. That's it!</p><p>Last thing we need to do is start <code>myThread</code> inside contructor and terminate it in decontructor:</p><pre class="line-numbers language-csharp"><code>using System.Diagnostics;
using System;
using System.Threading;
namespace DLLResearch
{
	[AlwaysInclude] // &lt;- We need this to include our class
	public static class Program
	{
		public static Thread myThread = new Thread(new () =&gt; ThreadMethod());
		public static bool exit = false;

		// This will gets called when our library gets loaded
		public static this() 
		{
			myThread.Start(); // &lt;- Start our thread
			Debug.WriteLine("Hello From Beef DLL :3");
		}

		// This will gets called when our library gets unloaded
		public static ~this() 
		{
			exit = true; // Notify we want to exit
			myThread.Join(500); // Wait max 500 ms for thread to finish
			
			Debug.WriteLine("See ya next time my friend :)");
		}

		public static void ThreadMethod()
		{
			Debug.WriteLine("ThreadMethod started.");
			var i = 0; 
			while(!exit)
			{
				Debug.WriteLine("Hello from Beef DLL. Counter: {}", i++);
				Thread.Sleep(500); // Wait 500 ms
			}
			Debug.WriteLine("ThreadMethod ended.");
		}
	}
}
</code></pre><p>Compile it and inject your DLL into some process (notepad in my case) and after some time unload it.</p><figure class="post__image post__image--center"><img loading="lazy" src="https://m0n7y5.github.io/media/posts/4/DebugView_2MlTYjqQfV.png" sizes="(max-width: 48em) 100vw, 768px" srcset="https://m0n7y5.github.io/media/posts/4/responsive/DebugView_2MlTYjqQfV-xs.png 300w, https://m0n7y5.github.io/media/posts/4/responsive/DebugView_2MlTYjqQfV-sm.png 480w, https://m0n7y5.github.io/media/posts/4/responsive/DebugView_2MlTYjqQfV-md.png 768w, https://m0n7y5.github.io/media/posts/4/responsive/DebugView_2MlTYjqQfV-lg.png 1024w, https://m0n7y5.github.io/media/posts/4/responsive/DebugView_2MlTYjqQfV-xl.png 1360w, https://m0n7y5.github.io/media/posts/4/responsive/DebugView_2MlTYjqQfV-2xl.png 1600w" height="700" width="700" alt=""><figcaption>DebugView++ Output: Output from DLL</figcaption></figure><p>And it works! Working on DLL using Beef is fun and really simple. Next time i am gonna try to create simple plugin system for DLLs made in Beef.&nbsp;</p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on September 3, 2020</p><ul class="post__tag"><li><a href="https://m0n7y5.github.io/page/beef/">Beef</a></li><li><a href="https://m0n7y5.github.io/page/beeflang/">Beeflang</a></li><li><a href="https://m0n7y5.github.io/page/dll/">DLL</a></li><li><a href="https://m0n7y5.github.io/page/research/">Research</a></li></ul><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fm0n7y5.github.io%2Fbeef-dll-creation-and-research-2%2F" class="js-share facebook" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://m0n7y5.github.io/assets/svg/svg-map.svg#facebook"/></svg> <span>Facebook</span></a></div><div class="post__bio bio"><img class="bio__avatar" src="https://m0n7y5.github.io/media/website/kek2_H200.png" loading="lazy" alt="Admin"><div class="bio__info"><h3 class="bio__name"><a href="https://m0n7y5.github.io/authors/admin/" class="invert" rel="author">Admin</a></h3><p>I am a developer and i am in love with C/C#/Beef. I am focused on developing apps for Desktop (UI/CLI) and developing firmware for MCUs using ARM CPU from STM32 and Espressif. I am currently trying to master reverse engineering etc.</p></div></div></footer></article><div class="post__comments"><div class="wrapper"><h2 class="h5">Comments</h2><div id="disqus_thread"></div><script>var disqus_config = function () {
                       this.page.url = 'https://m0n7y5.github.io/beef-dll-creation-and-research-2/';
               		this.page.identifier = '4';
                   };
               
                   var disqus_loaded = false;
               
                   function publiiLoadDisqus() {
                       if(disqus_loaded) {
                           return false;
                       }
               
                       var top = document.getElementById('disqus_thread').offsetTop;
               
                       if (!disqus_loaded && (window.scrollY || window.pageYOffset) + window.innerHeight > top) {
                           disqus_loaded = true;
               
                           (function () {
                               var d = document, s = d.createElement('script');
                               s.src = 'https://based-and-pasted.disqus.com/embed.js';
                               s.setAttribute('data-timestamp', +new Date());
                               (d.head || d.body).appendChild(s);
                           })();
                       }
                   }
               
                   publiiLoadDisqus();
               
                   window.onscroll = function() {
                       publiiLoadDisqus();
                   };</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" target="_blank" rel="nofollow noopener noreferrer">comments powered by Disqus.</a></noscript></div></div></main><footer class="footer"><div class="footer__copyright"><blockquote><p>Look at you, hacker: a pathetic creature of meat and bone, panting and sweating as you run through my corridors. How can you challenge a perfect, immortal machine?</p></blockquote><p class="align-right"><em>- Shodan (System Shock 1999)</em></p><p class="align-center"><a href="https://m0n7y5.github.io/"><em>https://m0n7y5.github.io/</em></a></p></div><button class="footer__bttop js-footer__bttop" aria-label="Back to top"><svg><title>Back to top</title><use xlink:href="https://m0n7y5.github.io/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.top',
   };</script><script defer="defer" src="https://m0n7y5.github.io/assets/js/scripts.min.js?v=f4c4d35432d0e17d212f2fae4e0f8247"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><div class="cookie-popup js-cookie-popup cookie-popup--uses-badge"><h2>This website uses cookies</h2><p>Select which cookies to opt-in to via the checkboxes below; our website uses cookies to examine site traffic and user activity while on our site, for marketing, and to provide social media functionality. <a href="#not-specified">More details...</a></p><form><input id="gdpr-necessary" name="gdpr-necessary" checked="checked" disabled="disabled" type="checkbox"> <label for="gdpr-necessary">Required</label> <input id="gdpr-functions" name="gdpr-functions" type="checkbox"> <label for="gdpr-functions">Functionality</label> <input id="gdpr-analytics" name="gdpr-analytics" type="checkbox"> <label for="gdpr-analytics">Analytical</label> <input id="gdpr-marketing" name="gdpr-marketing" type="checkbox"> <label for="gdpr-marketing">Marketing</label><p class="cookie-popup__save-wrapper"><button type="submit" class="cookie-popup__save">Save</button></p></form><span class="cookie-popup-label">Cookie Policy</span></div><script>(function() {
                function addScript (src, inline) {
                    var newScript = document.createElement('script');

                    if (src) {
                        newScript.setAttribute('src', src);
                    }

                    if (inline) {
                        newScript.text = inline;
                    }

                    document.body.appendChild(newScript);
                }

                var popup = document.querySelector('.js-cookie-popup');
                var checkboxes = popup.querySelectorAll('input[type="checkbox"]');
                var save = popup.querySelector('button');
                var currentConfig = localStorage.getItem('publii-gdpr-allowed-cookies');
                var blockedScripts = document.querySelectorAll('script[type^="gdpr-blocker/"]');
                

                popup.addEventListener('click', function() {
                    if (!popup.classList.contains('cookie-popup--is-sticky')) {
                        popup.classList.add('cookie-popup--is-sticky');
                    }
                });

                save.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    popup.classList.remove('cookie-popup--is-sticky');
                    var allowedGroups = [];

                    for (var i = 0; i < checkboxes.length; i++) {
                        if (checkboxes[i].checked) {
                            var groupName = checkboxes[i].getAttribute('name').replace('gdpr-', '');
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + groupName + '"]');

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }

                            allowedGroups.push(groupName);
                        }
                    }

                    localStorage.setItem('publii-gdpr-allowed-cookies', allowedGroups.join(','));
                    popup.classList.remove('cookie-popup--is-sticky');

                    setTimeout(function () {
                        if (currentConfig !== null) {
                            window.location.reload();
                        }
                    }, 250);
                });

                if (currentConfig === null) {
                    popup.classList.add('cookie-popup--is-sticky');
                } else {
                    if (currentConfig !== '') {
                        var allowedGroups = currentConfig.split(',');

                        for (var i = 0; i < allowedGroups.length; i++) {
                            var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroups[i] + '"]');
                            var checkbox = popup.querySelector('input[type="checkbox"][name="gdpr-' + allowedGroups[i] + '"]');

                            if (checkbox) {
                                checkbox.checked = true;
                            }

                            for (var j = 0; j < scripts.length; j++) {
                                addScript(scripts[j].src, scripts[j].text);
                            }
                        }
                    }
                }
            })();</script></body></html>